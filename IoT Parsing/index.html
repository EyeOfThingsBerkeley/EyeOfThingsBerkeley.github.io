<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>IoT Parser</title>  
	<script src="js/papaparse.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
</body>

<script>

	$.ajax({
		//url:"data/WolframDataDropRawData_DD9166f904472-c765-49bc-8ef6-c2d5f30112ae.tsv"
		url:"data/data_pipe_sep.txt"
		//Note this data has been preprocessed 
	}).done(function(d){
		papaParser(d)
	})

	function papaParser(file){
		Papa.parse(file, {
			complete: function(results) {
				console.log(results);
				convert(results);
			}
		});
	}

	function convert(data){
		var newData = []
		for(var i = 0; i < data.data.length; i++){
			//convert each of the sub array to a json then add to the array

			var str = '{';
			for(var e = 0; e < data.data[i].length; e++){
				var key = data.data[i][e].split('=')[0];
				var value = data.data[i][e].split('=')[1];
				if(e > 0 && key != "")
					str = str.concat(',');
				if(key != "")
					str = str.concat('"' + key + '":"' + value + '"');
			}

			//str = str.concat(data.data[i].join());
			str = str.concat('}');
			//console.log(str);

			try{
				//console.log(JSON.stringify(eval("(" + str + ")"))['Timestamp

				var jsonStr = JSON.parse(str);
				console.log(i + " - " + jsonStr['Timestamp'])
				//having problems in parsing '['
			}catch(error){
				console.log(str)
				console.log(error)
			}


			//strJSON = JSON.stringify(str);//.replace(/["]+/g, '');

			/*console.log(strJSON);
			/*Papa.parse(data.data[i].join(), {
				complete: function(results) {
					console.log(results);
					convert(results);
				}
			});*/
		}
	}

</script>
</html>