<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>IoT Parser</title>  
	<script src="js/papaparse.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<!--Need to download JQuery -->
</head>

<body>
</body>

<script>
	var results = []
	$.ajax({//how to load a local file without JQuery
		url:"data/DataDrop_Output_2.csv"
		//Note this data has been preprocessed 
	}).done(function(d){
		papaParser(d)
	})

	function papaParser(file){
		Papa.parse(file, {
			complete: function(data) {
				console.log(data);
				results = data;
				//convert(results);
				var target_col = '|activity_type |';
				var target_item = '|pocket|'
				var target_data = ['|change value1 |', '|excerpttagsurl|', '|target_displayname|'];
				access(target_col, target_item, target_data);
			}
		});
	}

	/*function convert(data){
		var newData = []
		for(var i = 0; i < data.data.length; i++){
			//convert each of the sub array to a json then add to the array

			var str = '{';
			for(var e = 0; e < data.data[i].length; e++){
				var key = data.data[i][e].split('=')[0];
				var value = data.data[i][e].split('=')[1];
				if(e > 0 && key != "")
					str = str.concat(',');
				if(key != "")
					str = str.concat('"' + key + '":"' + value + '"');
			}

			//str = str.concat(data.data[i].join());
			str = str.concat('}');
			//console.log(str);

			try{
				//console.log(JSON.stringify(eval("(" + str + ")"))['Timestamp

				var jsonStr = JSON.parse(str);
				console.log(i + " - " + jsonStr['Timestamp'])
				//having problems in parsing '['

				var key = [];
				for(keys in jsonStr)
					key.push(keys);
				console.log(key)
				
			}catch(error){
				console.log(str)
				console.log(error)
			}
		}
	}*/
	function access(target_col, target_item, target_data){//need to convert target_data to col #
		var header = results.data[0];
		console.log(header)
		var col = 0;
		var target_data_col = []
		for(i in header){
			if(header[i] == target_col){
				console.log(i + " : " + header[i])
				col = i;//getthe target column
			}
			if(target_data.indexOf(header[i]) > -1)
				target_data_col.push(i);
		}
		console.log(target_data_col)

		var rows = results.data;
		var information = [];
		for(i in rows){
			if(rows[i][col] == target_item){//at the target row
				var information_row = []
				for(c in rows[i]){
					if(target_data_col.indexOf(c) > -1){
						information_row.push(rows[i][c]);
					}
				}
				information.push(information_row);
				information_row = [];
			}
		}
		console.log(information)
	}

</script>
</html>